# Docker entrypoint replaces this file with a customized version,
# so we only need to add settings that are not covered by environment variables.

#------------------------------------------------------------------------------
# WRITE AHEAD LOG
#------------------------------------------------------------------------------

# - Settings -
wal_level = logical             # minimal, replica, or logical
                                # (change requires restart)
# fsync = on                    # flush data to disk after each commit
# synchronous_commit = on       # synchronization level;
                                # off, local, remote_write, remote_apply, or on
# wal_sync_method = fsync       # the default is the first option
                                # supported by the operating system:
                                #   open_datasync
                                #   fdatasync (default on Linux)
                                #   fsync
                                #   fsync_writethrough
                                #   open_sync
# full_page_writes = on         # recover from partial page writes
# wal_log_hints = off           # also do full page writes of hint bits
                                # (change requires restart)
# wal_buffers = -1              # min 16MB, based on shared_buffers
                                # (change requires restart)
# wal_writer_delay = 200ms      # 1-10000 milliseconds
# wal_writer_flush_after = 1MB  # amount of WAL written before committing
# wal_skip_threshold = 2MB

# - Checkpoints -
#checkpoint_timeout = 5min              # range 30s-1d
#checkpoint_completion_target = 0.9     # checkpoint target duration, 0.0 - 1.0
#checkpoint_flush_after = 256kB         # measured in pages, 0 disables
#checkpoint_warning = 30s               # 0 disables

# - Archiving -
#archive_mode = off             # enables archiving; off, on, or always
                                # (change requires restart)
#archive_command = ''           # command to use to archive a logfile segment
                                # e.g. 'test ! -f /mnt/server/archivedir/%f && cp %p /mnt/server/archivedir/%f'
#archive_timeout = 0            # force a logfile segment switch after this
                                # number of seconds; 0 disables

#------------------------------------------------------------------------------
# REPLICATION
#------------------------------------------------------------------------------

# - Sending Servers -

# Set these parameters on the primary and standby server(s) for sending WAL
# data to other servers.

max_wal_senders = 10            # max number of walsender processes
                                # (change requires restart)
#wal_keep_segments = 0          # in logfile segments, 16MB each; 0 disables
wal_keep_size = 256MB           # in MB; 0 disables
                                # (wal_keep_segments is obsolete)

#max_slot_wal_keep_size = -1    # max WAL size to keep for replication slots
                                # -1 disables (change requires restart)

# - Master Server -

# These settings are ignored on a standby server.

#max_replication_slots = 10     # max number of replication slots
                                # (change requires restart)
#synchronous_standby_names = '' # standby servers that provide sync rep
                                # e.g. 'standby1, standby2 (*)'
#vacuum_defer_cleanup_age = 0   # number of transactions by which VACUUM and
                                # HOT cleanup should be deferred

# - Standby Servers -

# These settings are ignored on a master server.

#primary_conninfo = ''          # connection string to sending server
#primary_slot_name = ''         # replication slot on sending server
#promote_trigger_file = ''      # file name whose presence ends recovery
#hot_standby = on                       # "on" allows queries during recovery
                                # (change requires restart)
#max_standby_archive_delay = 30s        # max delay before canceling queries
                                # when reading WAL from archive;
                                # -1 allows indefinite delay
#max_standby_streaming_delay = 30s      # max delay before canceling queries
                                # when reading streaming WAL;
                                # -1 allows indefinite delay
#wal_receiver_create_temp_slot = off    # create temp slot if primary_slot_name
                                # is not set. (change requires restart)
#wal_receiver_status_interval = 10s     # send replies at least this often
                                # 0 disables
#hot_standby_feedback = off             # send info from standby to prevent
                                # query conflicts
#wal_receiver_timeout = 60s             # time that receiver waits for
                                # communication from master
                                # 0 disables
#wal_retrieve_retry_interval = 5s       # time to wait before retrying to
                                # retrieve WAL after a failed attempt
#recovery_min_apply_delay = 0   # minimum delay for applying changes during
                                # recovery

#------------------------------------------------------------------------------
# SUBSCRIBER
#------------------------------------------------------------------------------
max_replication_slots = 10      # At least one slot for Debezium
max_logical_replication_workers = 4 # Number of workers for logical replication
# max_sync_workers_per_subscription = 2 # Number of workers for initial data sync

# Other settings can be left as default or tuned as needed.
listen_addresses = '*' # Listen on all available IP addresses within the container
# shared_buffers = 128MB # Default is fine for a small setup
# dynamic_shared_memory_type = posix # Default
# log_timezone = 'Etc/UTC' # Default
# datestyle = 'iso, mdy' # Default
# timezone = 'Etc/UTC' # Default
# lc_messages = 'en_US.utf8' # Default
# lc_monetary = 'en_US.utf8' # Default
# lc_numeric = 'en_US.utf8' # Default
# lc_time = 'en_US.utf8' # Default
# default_text_search_config = 'pg_catalog.english' # Default

#------------------------------------------------------------------------------
# ERROR REPORTING AND LOGGING
#------------------------------------------------------------------------------

log_connections = on
log_disconnections = on
log_error_verbosity = verbose