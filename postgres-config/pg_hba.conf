# pg_hba.conf
#
# PostgreSQL Host-Based Authentication file
#
# For a detailed description of this file, see the PostgreSQL documentation
# Chapter 21, Client Authentication.
#
# Entries are processed in order, so put more specific entries first.
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only.
# These are typically used by local applications and psql.
# Changed from 'peer' to 'scram-sha-256' to enforce password auth for local connections.
local   all             all                                     scram-sha-256

# IPv4 local connections:
# These allow connections from the host machine itself via TCP/IP.
host    all             all             127.0.0.1/32            scram-sha-256

# IPv6 local connections:
# Similar to IPv4 local connections, but for IPv6.
host    all             all             ::1/128                 scram-sha-256

# Allow replication connections from any IP address for the 'replicator' user.
# This user will be created with REPLICATION privilege and a strong password.
# Debezium's Kafka Connect container will use this to stream WAL changes.
# Using 0.0.0.0/0 for IPv4 and ::/0 for IPv6 allows connections from any IP.
# For production, you would restrict ADDRESS to the specific IP(s) or subnet(s)
# of your Kafka Connect instances.
host    replication     replicator      0.0.0.0/0               scram-sha-256
host    replication     replicator      ::/0                    scram-sha-256

# Allow the 'debezium_user' to connect to the 'inventory_db' database from any IP.
# This user will be granted necessary permissions on the tables Debezium monitors.
# Debezium uses this to perform the initial snapshot and potentially other operations.
host    inventory_db    debezium_user   0.0.0.0/0               scram-sha-256
host    inventory_db    debezium_user   ::/0                    scram-sha-256

# Allow the 'postgres_user' (superuser defined in docker-compose.yml)
# to connect to the 'inventory_db' from any IP for administrative/testing purposes.
host    inventory_db    postgres_user   0.0.0.0/0               scram-sha-256
host    inventory_db    postgres_user   ::/0                    scram-sha-256

# Allow the 'postgres_user' (superuser) to connect to all databases from any IP.
# This is a general rule for the superuser for administrative tasks.
host    all             postgres_user   0.0.0.0/0               scram-sha-256
host    all             postgres_user   ::/0                    scram-sha-256

# Example of a more restrictive rule if you know the Docker network:
# Assuming your Docker network is 172.18.0.0/16
# host    replication     replicator      172.18.0.0/16           scram-sha-256
# host    inventory_db    debezium_user   172.18.0.0/16           scram-sha-256
# host    inventory_db    postgres_user   172.18.0.0/16           scram-sha-256